---
import BaseLayout from './BaseLayout.astro';
import Header from '@/components/layout/Header.astro';
import Footer from '@/components/layout/Footer.astro';
import RelatedPosts from '@/components/blog/RelatedPosts.astro';
import Badge from '@/components/ui/Badge.astro';
import type { CollectionEntry } from 'astro:content';
import { formatDate } from '@/utils/formatDate';
import { getReadingTime } from '@/utils/getRelatedPosts';

interface Props {
	post: CollectionEntry<'blog'>;
	relatedPosts?: CollectionEntry<'blog'>[];
}

const { post, relatedPosts = [] } = Astro.props;
const { title, description, pubDate, tags } = post.data;
const readingTime = getReadingTime(post.body);
---

<BaseLayout
	title={title}
	description={description}
	type="article"
	publishedTime={pubDate.toISOString()}
>
	<Header />

	<main class="container mx-auto px-4 py-12">
		<div class="mx-auto max-w-3xl">
			<!-- Post header -->
			<header class="mb-12 space-y-4">
				<h1 class="font-display text-3xl font-bold sm:text-4xl text-purple">{title}</h1>
				<div class="flex flex-wrap items-center gap-3 font-mono text-sm text-comment">
					<span>//</span>
					<time datetime={pubDate.toISOString()}>
						{formatDate(pubDate)}
					</time>
					<span class="text-cyan">{readingTime} min read</span>
				</div>
				{tags && tags.length > 0 && (
					<div class="flex flex-wrap gap-2">
						{tags.map((tag) => (
							<Badge href={`/blog/tag/${tag.toLowerCase()}`}>{tag}</Badge>
						))}
					</div>
				)}
			</header>

			<!-- Content -->
			<article class="prose prose-lg max-w-none">
				<slot />
			</article>

			<!-- Related Posts -->
			{relatedPosts.length > 0 && <RelatedPosts posts={relatedPosts} />}
		</div>
	</main>

	<Footer />
</BaseLayout>

<style is:global>
	.prose h2 {
		@apply scroll-mt-24 font-display text-2xl font-bold mt-12 mb-4 text-purple;
	}

	.prose h3 {
		@apply scroll-mt-24 font-display text-xl font-bold mt-8 mb-3 text-purple/85;
	}

	.prose a {
		@apply text-green hover:text-green/80 transition-colors;
	}

	.prose code {
		@apply rounded bg-muted px-1.5 py-0.5 text-sm font-mono text-red;
	}

	.prose pre {
		@apply my-6 overflow-x-auto rounded-lg border border-border bg-muted p-4;
	}

	.prose pre code {
		@apply bg-transparent p-0 text-inherit;
	}

	.prose blockquote {
		@apply border-l-2 border-comment pl-4 italic my-6 text-comment;
	}
</style>
