---
import { getCollection, type CollectionEntry } from 'astro:content';
import PageLayout from '@/layouts/PageLayout.astro';
import Badge from '@/components/ui/Badge.astro';
import { formatDate } from '@/utils/formatDate';

export async function getStaticPaths() {
	const projects = await getCollection('projects');

	return projects.map((project) => ({
		params: { slug: project.slug },
		props: { project },
	}));
}

interface Props {
	project: CollectionEntry<'projects'>;
}

const { project } = Astro.props;
const { title, description, techStack, demoUrl, githubUrl, completedDate } = project.data;
const { Content } = await project.render();
---

<PageLayout title={title} description={description}>
	<div class="mb-8">
		<a href="/projects" class="font-mono text-sm text-comment hover:text-green transition-colors">
			← Back to Projects
		</a>
	</div>

	<header class="mb-12 space-y-4">
		<h1 class="font-display text-3xl font-bold sm:text-4xl text-gold">{title}</h1>
		<p class="text-foreground/70">{description}</p>

		<div class="font-mono text-sm text-comment">
			// Completed {formatDate(completedDate)}
		</div>

		{techStack && techStack.length > 0 && (
			<div class="flex flex-wrap gap-2">
				{techStack.map((tech) => (
					<Badge>{tech}</Badge>
				))}
			</div>
		)}

		{(demoUrl || githubUrl) && (
			<div class="flex gap-4 text-sm">
				{demoUrl && (
					<a href={demoUrl} target="_blank" rel="noopener noreferrer" class="font-mono text-green hover:text-green/80 transition-colors">
						Live Demo ↗
					</a>
				)}
				{githubUrl && (
					<a href={githubUrl} target="_blank" rel="noopener noreferrer" class="font-mono text-green hover:text-green/80 transition-colors">
						Source Code ↗
					</a>
				)}
			</div>
		)}
	</header>

	<article class="prose prose-lg max-w-none">
		<Content />
	</article>
</PageLayout>
