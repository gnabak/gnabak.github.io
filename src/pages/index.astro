---
import { getCollection } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import BlogCard from '@/components/blog/BlogCard.astro';
import { sortPostsByDate, filterDraftPosts, getFeaturedProjects } from '@/utils/sortPosts';

// Get latest blog posts (3)
const allPosts = await getCollection('blog');
const publishedPosts = filterDraftPosts(allPosts);
const sortedPosts = sortPostsByDate(publishedPosts);
const latestPosts = sortedPosts.slice(0, 3);

// Get featured projects (2)
const allProjects = await getCollection('projects');
const featuredProjects = getFeaturedProjects(allProjects).slice(0, 2);
---

<BaseLayout
	title="gnabak"
	description="Backend Software Engineer at Amazon in Vancouver. Building scalable systems and writing about development."
>
	<main class="container mx-auto px-4 py-12">
		<div class="mx-auto max-w-3xl space-y-14">
			<!-- Hero -->
			<section class="space-y-6 relative overflow-hidden" id="ascii-banner">
				<pre class="text-gold font-mono text-[0.45rem] leading-[1.1] sm:text-[0.6rem] md:text-xs select-none" aria-label="gnabak">{`
  ██████╗ ███╗   ██╗ █████╗ ██████╗  █████╗ ██╗  ██╗
 ██╔════╝ ████╗  ██║██╔══██╗██╔══██╗██╔══██╗██║ ██╔╝
 ██║  ███╗██╔██╗ ██║███████║██████╔╝███████║█████╔╝
 ██║   ██║██║╚██╗██║██╔══██║██╔══██╗██╔══██║██╔═██╗
 ╚██████╔╝██║ ╚████║██║  ██║██████╔╝██║  ██║██║  ██╗
  ╚═════╝ ╚═╝  ╚═══╝╚═╝  ╚═╝╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝`}</pre>

				<div class="font-mono text-sm space-y-1">
					<p>
						<span class="text-comment">$</span> <span class="text-foreground">whoami</span>
					</p>
					<p class="text-green">
						<span class="typing-line">&gt; backend engineer, snowboarder, builder</span>
					</p>
				</div>

				<div class="font-mono text-sm space-y-1">
					<p>
						<span class="text-comment">$</span> <span class="text-foreground">cat role.txt</span>
					</p>
					<p class="text-foreground/80">
						&gt; software engineer at <span class="text-orange">Amazon</span> in Vancouver.
					</p>
					<p class="text-foreground/80">
						&gt; building scalable, low-latency systems in high-throughput environments.
					</p>
				</div>
				<a href="/about" class="inline-block font-mono text-sm text-comment hover:text-green transition-colors">
					man gnabak →
				</a>
			</section>

			<!-- Latest Posts -->
			{latestPosts.length > 0 && (
				<section class="space-y-6">
					<h2 class="font-display text-2xl font-bold text-gold">
						Recent Writing
					</h2>
					<div class="space-y-2">
						{latestPosts.map((post, index) => (
							<BlogCard post={post} lineNumber={index + 1} />
						))}
					</div>
					<a href="/posts" class="inline-block font-mono text-sm text-comment hover:text-green transition-colors">
						cd ~/posts →
					</a>
				</section>
			)}

			<!-- Projects -->
			{featuredProjects.length > 0 && (
				<section class="space-y-6">
					<h2 class="font-display text-2xl font-bold text-gold">
						Projects
					</h2>
					<div class="space-y-6">
						{featuredProjects.map((project) => (
							<a href={`/projects/${project.slug}`} class="block group">
								<article class="space-y-3 p-4 line-highlight border border-border rounded-lg">
									<h3 class="text-lg font-semibold group-hover:text-green transition-colors">
										{project.data.title}
									</h3>
									<p class="text-foreground/70 text-sm">
										{project.data.description}
									</p>
									{project.data.techStack && project.data.techStack.length > 0 && (
										<div class="flex flex-wrap gap-2">
											{project.data.techStack.slice(0, 4).map((tech) => (
												<span class="font-mono text-xs px-2 py-1 rounded bg-muted text-orange border border-border">
													{tech}
												</span>
											))}
										</div>
									)}
								</article>
							</a>
						))}
					</div>
					<a href="/projects" class="inline-block font-mono text-sm text-comment hover:text-green transition-colors">
						cd ~/projects →
					</a>
				</section>
			)}

			<!-- Contact -->
			<section class="flex items-center gap-5 pt-8 border-t border-border">
				<!-- GitHub -->
				<a href="https://github.com/gnabak" target="_blank" rel="noopener noreferrer"
					class="text-comment hover:text-green transition-colors" title="GitHub">
					<svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor" style="image-rendering: pixelated;">
						<rect x="4" y="0" width="8" height="1"/><rect x="2" y="1" width="2" height="1"/><rect x="12" y="1" width="2" height="1"/>
						<rect x="1" y="2" width="1" height="1"/><rect x="14" y="2" width="1" height="1"/>
						<rect x="0" y="3" width="1" height="6"/><rect x="15" y="3" width="1" height="6"/>
						<rect x="1" y="3" width="1" height="1"/><rect x="4" y="3" width="2" height="2"/><rect x="10" y="3" width="2" height="2"/><rect x="14" y="3" width="1" height="1"/>
						<rect x="1" y="9" width="1" height="1"/><rect x="14" y="9" width="1" height="1"/>
						<rect x="2" y="10" width="2" height="1"/><rect x="12" y="10" width="2" height="1"/>
						<rect x="4" y="11" width="8" height="1"/>
						<rect x="4" y="12" width="2" height="1"/><rect x="10" y="12" width="2" height="1"/>
						<rect x="3" y="13" width="2" height="1"/><rect x="11" y="13" width="2" height="1"/>
						<rect x="3" y="14" width="1" height="2"/><rect x="12" y="14" width="1" height="2"/>
					</svg>
				</a>
				<!-- LinkedIn -->
				<a href="https://linkedin.com/in/gustavo-seixas" target="_blank" rel="noopener noreferrer"
					class="text-comment hover:text-green transition-colors" title="LinkedIn">
					<svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor" style="image-rendering: pixelated;">
						<rect x="1" y="0" width="14" height="1"/><rect x="0" y="1" width="1" height="14"/><rect x="15" y="1" width="1" height="14"/><rect x="1" y="15" width="14" height="1"/>
						<rect x="1" y="1" width="14" height="14" fill="currentColor" opacity="0.15"/>
						<rect x="3" y="3" width="2" height="2"/><rect x="3" y="6" width="2" height="7"/>
						<rect x="6" y="6" width="2" height="1"/><rect x="6" y="7" width="1" height="6"/>
						<rect x="7" y="7" width="2" height="1"/><rect x="9" y="6" width="2" height="1"/>
						<rect x="11" y="7" width="1" height="6"/><rect x="9" y="8" width="2" height="5"/><rect x="7" y="8" width="2" height="5"/>
					</svg>
				</a>
				<!-- Email -->
				<a href="mailto:gustavo.nb.seixas@gmail.com"
					class="text-comment hover:text-green transition-colors" title="Email">
					<svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor" style="image-rendering: pixelated;">
						<rect x="0" y="2" width="16" height="1"/><rect x="0" y="3" width="1" height="10"/><rect x="15" y="3" width="1" height="10"/><rect x="0" y="13" width="16" height="1"/>
						<rect x="1" y="3" width="2" height="1"/><rect x="13" y="3" width="2" height="1"/>
						<rect x="3" y="4" width="2" height="1"/><rect x="11" y="4" width="2" height="1"/>
						<rect x="5" y="5" width="2" height="1"/><rect x="9" y="5" width="2" height="1"/>
						<rect x="7" y="6" width="2" height="1"/>
					</svg>
				</a>
				<!-- RSS -->
				<a href="/rss.xml"
					class="text-comment hover:text-green transition-colors" title="RSS">
					<svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor" style="image-rendering: pixelated;">
						<rect x="1" y="0" width="14" height="1"/><rect x="0" y="1" width="1" height="14"/><rect x="15" y="1" width="1" height="14"/><rect x="1" y="15" width="14" height="1"/>
						<rect x="1" y="1" width="14" height="14" fill="currentColor" opacity="0.15"/>
						<rect x="3" y="11" width="2" height="2"/>
						<rect x="3" y="8" width="2" height="1"/><rect x="5" y="9" width="1" height="2"/><rect x="6" y="11" width="1" height="2"/>
						<rect x="3" y="5" width="2" height="1"/><rect x="5" y="5" width="1" height="1"/><rect x="7" y="6" width="1" height="2"/><rect x="8" y="8" width="1" height="2"/><rect x="9" y="10" width="1" height="2"/><rect x="9" y="11" width="1" height="2"/>
					</svg>
				</a>
			</section>
		</div>
	</main>
<script>
	const banner = document.getElementById('ascii-banner');
	if (banner) {
		let clicks: number[] = [];
		banner.addEventListener('click', () => {
			const now = Date.now();
			clicks.push(now);
			clicks = clicks.filter(t => now - t < 5000);
			if (clicks.length >= 7) {
				clicks = [];
				// Create full-screen overlay for animation
				const overlay = document.createElement('div');
				overlay.style.cssText = 'position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:50;pointer-events:none;overflow:hidden;';
				document.body.appendChild(overlay);
				const boarder = document.createElement('div');
				boarder.innerHTML = `<svg width="24" height="24" viewBox="0 0 16 16" style="image-rendering:pixelated" fill="rgb(var(--color-green))">
					<rect x="7" y="1" width="3" height="1"/>
					<rect x="7" y="2" width="3" height="2"/>
					<rect x="7" y="2" width="3" height="1" fill="rgb(var(--color-orange))"/>
					<rect x="7" y="4" width="3" height="2" fill="rgb(var(--color-orange))"/>
					<rect x="5" y="4" width="2" height="1"/>
					<rect x="10" y="5" width="2" height="1"/>
					<rect x="6" y="6" width="2" height="2"/>
					<rect x="9" y="6" width="2" height="2"/>
					<rect x="4" y="8" width="9" height="2" rx="1" fill="rgb(var(--color-green))"/>
					<rect x="2" y="9" width="1" height="1" fill="rgb(var(--color-foreground))" opacity="0.5"/>
					<rect x="13" y="9" width="1" height="1" fill="rgb(var(--color-foreground))" opacity="0.5"/>
				</svg>`;
				boarder.style.cssText = 'position:absolute;z-index:10;pointer-events:none;';
				overlay.appendChild(boarder);
				const w = window.innerWidth;
				const h = window.innerHeight;
				const dur = 6000;
				const start = performance.now();
				// Wide horizontal S-curves across the full screen
				const midX = w / 2;
				const sway = w * 0.4;
				const turns = 4;
				function getPos(t: number) {
					const x = midX + Math.sin(t * Math.PI * turns) * sway;
					const y = -24 + t * (h + 48);
					return { x, y };
				}
				// Draw trail as an SVG path
				const trailSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
				trailSvg.setAttribute('width', String(w));
				trailSvg.setAttribute('height', String(h));
				trailSvg.style.cssText = 'position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;overflow:visible;';
				const trailPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
				trailPath.setAttribute('fill', 'none');
				trailPath.setAttribute('stroke', 'rgb(var(--color-foreground))');
				trailPath.setAttribute('stroke-opacity', '0.3');
				trailPath.setAttribute('stroke-width', '2');
				trailPath.setAttribute('stroke-linecap', 'round');
				trailPath.setAttribute('stroke-linejoin', 'round');
				trailSvg.appendChild(trailPath);
				overlay.appendChild(trailSvg);
				let pathData = '';
				function frame(time: number) {
					const p = Math.min((time - start) / dur, 1);
					const ease = p < 0.5 ? 2 * p * p : 1 - Math.pow(-2 * p + 2, 2) / 2;
					const { x, y } = getPos(ease);
					boarder.style.left = x + 'px';
					boarder.style.top = y + 'px';
					if (!pathData) {
						pathData = `M${x + 12} ${y + 20}`;
					} else {
						pathData += ` L${x + 12} ${y + 20}`;
					}
					trailPath.setAttribute('d', pathData);
					if (p < 1) {
						requestAnimationFrame(frame);
					} else {
						boarder.remove();
						trailSvg.style.transition = 'opacity 2s ease';
						requestAnimationFrame(() => { trailSvg.style.opacity = '0'; });
						setTimeout(() => { overlay.remove(); }, 2100);
					}
				}
				requestAnimationFrame(frame);
			}
		});
	}
</script>
</BaseLayout>
