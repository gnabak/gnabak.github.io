---
import { getCollection } from 'astro:content';
import PageLayout from '@/layouts/PageLayout.astro';
import BlogCard from '@/components/blog/BlogCard.astro';
import Badge from '@/components/ui/Badge.astro';
import { sortPostsByDate, filterDraftPosts } from '@/utils/sortPosts';
import { getAllTags } from '@/utils/getAllTags';

const allPosts = await getCollection('blog');
const publishedPosts = filterDraftPosts(allPosts);
const posts = sortPostsByDate(publishedPosts);
const tagsWithCount = getAllTags(posts);
---

<PageLayout
	title="Posts"
	description="Writing about web development, programming, and tools."
>
	<div class="mb-12 space-y-6">
		<div class="font-mono text-sm space-y-1">
			<p>
				<span class="text-comment">$</span> <span class="text-foreground">ls ~/posts</span>
			</p>
			<p class="text-comment">&gt; {posts.length} posts found</p>
		</div>

		{tagsWithCount.length > 0 && (
			<div class="flex flex-wrap gap-2">
				{tagsWithCount.slice(0, 10).map((tag) => (
					<Badge href={`/posts/tag/${tag.name.toLowerCase()}`}>
						{tag.name} ({tag.count})
					</Badge>
				))}
			</div>
		)}
	</div>

	{posts.length > 0 ? (
		<div class="space-y-6">
			{posts.map((post, index) => (
				<BlogCard post={post} lineNumber={index + 1} />
			))}
		</div>
	) : (
		<p class="text-comment">No posts yet.</p>
	)}
</PageLayout>
