---
title: 'Implementing Dark Mode: A Complete Guide with Tailwind CSS'
description: 'Learn how to implement a robust dark mode feature with Tailwind CSS, including theme persistence and preventing flash of wrong theme.'
pubDate: 2024-02-05
author: 'Gustavo'
image: '/images/blog/dark-mode.svg'
imageAlt: 'Dark mode toggle illustration'
tags: ['tailwind', 'css', 'dark-mode', 'tutorial', 'ui']
category: 'tutorial'
featured: false
draft: false
---

# Implementing Dark Mode

Dark mode has become a must-have feature for modern web applications. Users love it, and implementing it correctly can significantly improve user experience. Let's build a robust dark mode system from scratch.

## Why Dark Mode Matters

- **Reduced eye strain** in low-light environments
- **Battery savings** on OLED screens
- **User preference** - some users strongly prefer one over the other
- **Accessibility** - helps users with light sensitivity

## The Challenge

Implementing dark mode correctly involves several challenges:

1. **No flash of wrong theme** on page load
2. **Persistent preference** across sessions
3. **Respect system preferences** by default
4. **Smooth transitions** between themes
5. **All components** must work in both modes

## Implementation Strategy

### 1. Setup with Tailwind CSS

First, configure Tailwind to support dark mode:

```javascript
// tailwind.config.mjs
export default {
	darkMode: ['class', '[data-theme="dark"]'],
	// ... rest of config
};
```

We're using the `data-theme` attribute instead of a class because it's more semantic and easier to query.

### 2. CSS Variables for Colors

Define colors as CSS variables that change based on theme:

```css
/* themes.css */
:root {
	--color-background: 255 255 255;
	--color-foreground: 15 23 42;
	--color-primary: 236 72 153;
}

[data-theme='dark'] {
	--color-background: 15 23 42;
	--color-foreground: 248 250 252;
	--color-primary: 244 114 182;
}
```

Using RGB values (without `rgb()`) allows Tailwind's alpha channel support:

```html
<div class="bg-primary/50">
	<!-- 50% opacity works! -->
</div>
```

### 3. Prevent Flash (Critical!)

The most common mistake is putting theme logic in your JavaScript - by then, it's too late. You need an inline script in your HTML `<head>`:

```html
<script is:inline>
	// This runs BEFORE the page renders
	const theme = localStorage.getItem('theme') || 'light';
	document.documentElement.setAttribute('data-theme', theme);
</script>
```

This must be:
- ✅ **Inline** (not an external script)
- ✅ In the **`<head>`** (before body content)
- ✅ **Synchronous** (not async/defer)

### 4. Theme Toggle Component

Create an interactive toggle:

```typescript
// DarkModeToggle.tsx (React example)
import { useEffect, useState } from 'react';

export function DarkModeToggle() {
	const [theme, setTheme] = useState('light');

	useEffect(() => {
		// Get theme from localStorage or system preference
		const stored = localStorage.getItem('theme');
		if (stored) {
			setTheme(stored);
		} else {
			const systemPreference = window.matchMedia(
				'(prefers-color-scheme: dark)'
			).matches
				? 'dark'
				: 'light';
			setTheme(systemPreference);
		}
	}, []);

	const toggleTheme = () => {
		const newTheme = theme === 'light' ? 'dark' : 'light';
		setTheme(newTheme);
		localStorage.setItem('theme', newTheme);
		document.documentElement.setAttribute('data-theme', newTheme);
	};

	return (
		<button
			onClick={toggleTheme}
			className="rounded-lg p-2 hover:bg-muted transition-colors"
			aria-label="Toggle theme"
		>
			{theme === 'light' ? (
				<MoonIcon className="h-5 w-5" />
			) : (
				<SunIcon className="h-5 w-5" />
			)}
		</button>
	);
}
```

### 5. Styling Components for Both Themes

Use Tailwind's `dark:` modifier:

```html
<div
	class="
  bg-white dark:bg-slate-900
  text-slate-900 dark:text-slate-50
  border-slate-200 dark:border-slate-700
">
	<h2
		class="
    text-pink-500 dark:text-pink-400
    hover:text-pink-600 dark:hover:text-pink-300
  ">
		Heading
	</h2>
</div>
```

## Advanced Techniques

### System Preference Detection

Respect the user's system preference:

```javascript
function getInitialTheme() {
	// 1. Check localStorage
	const stored = localStorage.getItem('theme');
	if (stored) return stored;

	// 2. Check system preference
	if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
		return 'dark';
	}

	// 3. Default to light
	return 'light';
}

// Listen for system preference changes
window
	.matchMedia('(prefers-color-scheme: dark)')
	.addEventListener('change', (e) => {
		if (!localStorage.getItem('theme')) {
			const newTheme = e.matches ? 'dark' : 'light';
			setTheme(newTheme);
		}
	});
```

### Smooth Transitions

Add CSS transitions when theme changes:

```css
* {
	transition-property: background-color, border-color, color;
	transition-duration: 300ms;
	transition-timing-function: ease-in-out;
}
```

But disable transitions on page load:

```html
<script is:inline>
	const theme = localStorage.getItem('theme') || 'light';
	document.documentElement.setAttribute('data-theme', theme);
	document.documentElement.classList.add('no-transition');
	setTimeout(() => {
		document.documentElement.classList.remove('no-transition');
	}, 0);
</script>
```

### Three-State Toggle

Some apps offer three options: Light, Dark, and System:

```typescript
type Theme = 'light' | 'dark' | 'system';

function applyTheme(theme: Theme) {
	if (theme === 'system') {
		const systemTheme = window.matchMedia('(prefers-color-scheme: dark)')
			.matches
			? 'dark'
			: 'light';
		document.documentElement.setAttribute('data-theme', systemTheme);
	} else {
		document.documentElement.setAttribute('data-theme', theme);
	}
	localStorage.setItem('theme', theme);
}
```

## Testing Your Dark Mode

Checklist to ensure everything works:

### Visual Testing
- [ ] All text is readable in both themes
- [ ] Images look good (may need different images per theme)
- [ ] Borders are visible
- [ ] Focus states are clear
- [ ] Shadows are appropriate for each theme

### Technical Testing
- [ ] No flash on page load
- [ ] Theme persists after refresh
- [ ] Theme persists across pages
- [ ] System preference is respected
- [ ] Toggle works immediately

### Accessibility
- [ ] Color contrast meets WCAG AA (4.5:1)
- [ ] Toggle button has proper aria-label
- [ ] Keyboard navigation works
- [ ] Screen readers announce theme changes

## Common Pitfalls

### ❌ Loading Theme Too Late

```html
<!-- BAD: External script loads after HTML is parsed -->
<script src="/theme.js"></script>
```

```html
<!-- GOOD: Inline script runs before rendering -->
<script is:inline>
	// Theme logic here
</script>
```

### ❌ Hardcoding Colors

```html
<!-- BAD: Won't change with theme -->
<div class="bg-white text-black"></div>
```

```html
<!-- GOOD: Uses theme-aware colors -->
<div class="bg-background text-foreground"></div>
```

### ❌ Forgetting Images

Images often need theme-specific versions:

```html
<picture>
	<source srcset="/logo-dark.svg" media="(prefers-color-scheme: dark)" />
	<img src="/logo-light.svg" alt="Logo" />
</picture>
```

## Complete Example

Here's a full implementation in Astro:

```astro
---
// BaseLayout.astro
interface Props {
	title: string;
}

const { title } = Astro.props;
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<title>{title}</title>

		<!-- Inline script to prevent flash -->
		<script is:inline>
			const theme = localStorage.getItem('theme') || 'light';
			document.documentElement.setAttribute('data-theme', theme);
		</script>
	</head>
	<body class="bg-background text-foreground">
		<slot />
	</body>
</html>
```

## Conclusion

Implementing dark mode correctly requires attention to detail, but the payoff is worth it. Key takeaways:

1. **Prevent flash** with inline script
2. **Use CSS variables** for theme colors
3. **Persist preference** in localStorage
4. **Respect system preferences**
5. **Test thoroughly** in both modes

Your users will appreciate the effort, and your app will look professional and polished.

## Resources

- [Tailwind Dark Mode Docs](https://tailwindcss.com/docs/dark-mode)
- [MDN: prefers-color-scheme](https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-color-scheme)
- [Josh Comeau: Dark Mode](https://www.joshwcomeau.com/react/dark-mode/)
